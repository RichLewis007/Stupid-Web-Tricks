---
// SoapBubbles.astro - Standalone reusable soap bubble animation component
//
/**
 * Configuration options:
 * @property {string} containerSelector - CSS selector for the container to size/position the canvas (default: 'body').
 * @property {string} canvasId - Unique ID applied to the canvas element; used for DOM lookups (default: 'soapBubblesCanvas').
 * @property {number} bubbleCount - Number of large bubbles to render simultaneously (default: 6).
 * @property {number} minRadius - Minimum radius, in pixels, when creating new bubbles (default: 20).
 * @property {number} maxRadius - Maximum radius, in pixels, when creating new bubbles (default: 60).
 * @property {string[]} collisionSelectors - Elements that trigger a pop when touched (default: none).
 * @property {boolean} enableMousePop - Whether bubbles pop when the mouse touches them (default: true).
 * @property {boolean} enableMouseInteraction - Whether bubbles react to/are attracted to the mouse (default: true).
 * @property {number} zIndex - CSS z-index applied to the canvas (default: 3).
 * @property {string} pointerEvents - Pointer-event mode for the canvas (default: 'none').
 */
const {
  containerSelector = 'body',
  canvasId = 'soapBubblesCanvas',
  bubbleCount = 6,
  minRadius = 20,
  maxRadius = 60,
  collisionSelectors = [],
  enableMousePop = true,
  enableMouseInteraction = true,
  zIndex = 3,
  pointerEvents = 'none',
} = Astro.props;

// Pass config to the initialization script
const config = {
  containerSelector,
  canvasId,
  bubbleCount,
  minRadius,
  maxRadius,
  collisionSelectors,
  enableMousePop,
  enableMouseInteraction,
};
---

<canvas
  id={canvasId}
  class="soap-bubbles-canvas"
  data-config={JSON.stringify(config)}
  style={`z-index: ${zIndex}; pointer-events: ${pointerEvents};`}></canvas>

<script define:vars={{ canvasId, config }}>
  import { initSoapBubbles } from '../../lib/bubbles/init.js';

  // Initialize using the specific canvasId for this component instance
  function initialize() {
    const canvas = document.getElementById(canvasId);
    if (canvas) {
      // Use the config passed via define:vars, which is scoped to this component instance
      initSoapBubbles(config);
    } else {
      // Canvas not found yet, retry
      setTimeout(initialize, 100);
    }
  }

  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', initialize);
  } else {
    setTimeout(initialize, 0);
  }
</script>

<style>
  .soap-bubbles-canvas {
    position: absolute !important;
    top: 0 !important;
    left: 0 !important;
    right: 0 !important;
    bottom: 0 !important;
    width: 100% !important;
    height: 100% !important;
  }
</style>
